<div class="fixed right-10 bottom-10 z-10" id="chatWidget">
    <div id="chat-system">
        <div class="flex items-center justify-center">
            <ul class="flex items-center flex-col" id="chat-list">
                <li class="cursor-pointer mb-2">
                    <div class="bg-[#49e670] rounded-full p-2">
                        <svg fill="#fff" height="30px" width="30px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7 .9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z" /></svg>
                    </div>
                </li>
                <li class="cursor-pointer mb-2">
                    <div class="bg-[#1e88e5] rounded-full p-2">
                        <svg fill="#fff" height="30px" width="30px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256.6 8C116.5 8 8 110.3 8 248.6c0 72.3 29.7 134.8 78.1 177.9 8.4 7.5 6.6 11.9 8.1 58.2A19.9 19.9 0 0 0 122 502.3c52.9-23.3 53.6-25.1 62.6-22.7C337.9 521.8 504 423.7 504 248.6 504 110.3 396.6 8 256.6 8zm149.2 185.1l-73 115.6a37.4 37.4 0 0 1 -53.9 9.9l-58.1-43.5a15 15 0 0 0 -18 0l-78.4 59.4c-10.5 7.9-24.2-4.6-17.1-15.7l73-115.6a37.4 37.4 0 0 1 53.9-9.9l58.1 43.5a15 15 0 0 0 18 0l78.4-59.4c10.4-8 24.1 4.5 17.1 15.6z" /></svg>
                    </div>
                </li>
                <li class="cursor-pointer mb-2">
                    <div class="bg-[#3eb9a9] rounded-full p-2">
                        <svg id="direct-message" fill="#fff" height="30px" width="30px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M512 240c0 114.9-114.6 208-256 208c-37.1 0-72.3-6.4-104.1-17.9c-11.9 8.7-31.3 20.6-54.3 30.6C73.6 471.1 44.7 480 16 480c-6.5 0-12.3-3.9-14.8-9.9c-2.5-6-1.1-12.8 3.4-17.4c0 0 0 0 0 0s0 0 0 0s0 0 0 0c0 0 0 0 0 0l.3-.3c.3-.3 .7-.7 1.3-1.4c1.1-1.2 2.8-3.1 4.9-5.7c4.1-5 9.6-12.4 15.2-21.6c10-16.6 19.5-38.4 21.4-62.9C17.7 326.8 0 285.1 0 240C0 125.1 114.6 32 256 32s256 93.1 256 208z" /></svg>
                    </div>
                </li>
            </ul>
        </div>
        <div class="" id="showChatProcess">
            <button class="p-2 bg-orange_color rounded-md">
                <svg id="chat-icon" fill="#fff" height="35px" width="35px" version="1.1"
                    xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 60 60"
                    xml:space="preserve">
                    <path
                        d="M54,2H6C2.748,2,0,4.748,0,8v33c0,3.252,2.748,6,6,6h28.558l9.703,10.673C44.454,57.885,44.724,58,45,58 c0.121,0,0.243-0.022,0.361-0.067C45.746,57.784,46,57.413,46,57V47h8c3.252,0,6-2.748,6-6V8C60,4.748,57.252,2,54,2z" />
                </svg>
                <svg id="cross-icon" fill="#fff" xmlns="http://www.w3.org/2000/svg" height="35px" width="35px" viewBox="0 0 384 512"><path d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z" />
                </svg>
            </button>
        </div>
    </div>
    <div id="show-chat-box" class="shadow-xl hidden bg-white rounded-lg overflow-hidden flex-col">
        <div class="bg-[#1c1b20] flex justify-between w-full h-10">
            <div class="flex items-center pl-2">
                <svg fill="#fff" height="30px" width="30px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 472.615 472.615" xml:space="preserve">
                    <g><g><path d="M186.318,5.058c-47.359,0-85.869,38.41-85.869,85.567c0,47.258,38.51,85.667,85.869,85.667 c47.358,0,85.869-38.41,85.869-85.667C272.187,43.468,233.676,5.058,186.318,5.058z" /></g></g>
                    <g><g><path d="M289.581,192.179l-18.501-5.429l-85.064,84.864l-85.165-84.864l-18.501,5.429C33.081,206.96,0,251.302,0,302.683v104.571 h231.224V276.51h137.737C359.675,236.813,329.623,204.14,289.581,192.179z" /></g></g>
                    <g><g><path d="M251.338,296.624v140.768h146.933l54.165,30.165v-30.165h20.18V296.624H251.338z M412.212,397.168H311.663v-20.11h100.549 V397.168z M442.377,356.949H281.499v-20.11h160.878V356.949z" /></g></g>
                </svg>
            </div>
            <div id="close-chat-box" class="flex items-center pr-2">
                <svg class="cursor-pointer text-[#fff] hover:text-orange_color" height="30px" width="30px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"/></svg>
            </div>
        </div>
        <div class="absolute right-0 bottom-20">
            <div class="pr-2 pb-2">Hello world</div>
        </div>
        <div class="absolute bottom-0 w-full shadow-inner shadow-gray-200 rounded-b-lg">
            <div class="box-border border border-black"></div>
            <div class="w-full bg-gray-200 pt-2 rounded-lg">
                <div id="chat-input" class="inline-block w-full px-2 bg-gray-200 rounded-b-xl">
                    <form action="" class="flex items-center border-2 border-gray-300 rounded-lg bg-gray-200 overflow-hidden justify-center">
                    <input type="text" id="message-input" placeholder="Type a message..." class="w-full shadow-2xl py-3 pl-2 mr-14 focus:outline-none caret-orange">
                    <textarea style="scrollbar-width: none;" name="message" id="message-input-textarea" rows="2" class="hidden w-full shadow-2xl py-2 pl-2 mr-14 focus:outline-none caret-orange resize-none"></textarea>
                        <button  id="message-send-btn" class="absolute right-6 flex flex-col justify-center" disabled>
                            <svg id="message-send-icon" class="text-red-400" height="30" width="30" transform="rotate(55)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480l0-83.6c0-4 1.5-7.8 4.2-10.8L331.8 202.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8 17.7 316.6C7.1 311.3 .3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <x-error />
</div>


<script>
    document.addEventListener("DOMContentLoaded", function() {
        let rotated = false;
        const chatIcon = document.getElementById("chat-icon");
        const crossIcon = document.getElementById("cross-icon");
        const chatList = document.getElementById("chat-list");
        const showChatProcess = document.getElementById("showChatProcess");
        const directMessage = document.getElementById("direct-message");
        const showChatBox = document.getElementById("show-chat-box");
        const chatSystem = document.getElementById("chat-system");
        const closeChatBox = document.getElementById("close-chat-box");
        
        const messageInput = document.getElementById("message-input");
        const messageInputTextarea = document.getElementById("message-input-textarea");
        const messageSendIcon = document.getElementById("message-send-icon");
        const showError = document.getElementById('open-pop-up');
        const showErrorMessage = document.getElementById("show-error-message");
        const messageSend = document.getElementById("message-send-btn");
        let messageSize;

        function messageSendButton(msgBtn){
            if(msgBtn.value.length>0){
                messageSendIcon.classList.remove("text-red-400");
                messageSendIcon.classList.add("text-orange_color");
                messageSend.disabled = false;
            }else{
                messageSendIcon.classList.add("text-red-400");
                messageSendIcon.classList.remove("text-orange_color");
                messageSend.disabled = true;
            }
        }

        if(messageInput){
            messageInput.addEventListener('input',function(){
                messageSendButton(messageInput);
                if(messageInput.clientWidth < messageInput.scrollWidth){
                    messageInputTextarea.value = messageInput.value;
                    messageSize=messageInput.value.length;
                    messageInputTextarea.style.display="block";
                    messageInput.style.display="none";
                    messageInputTextarea.focus();
                }
            });         
        }

        if(messageInputTextarea){
            messageInputTextarea.addEventListener('input',function(){
                messageSendButton(messageInputTextarea);
                if(messageSize > messageInputTextarea.value.length){
                    messageInput.value = messageInputTextarea.value;
                    messageSize=messageInputTextarea.value.length;
                    messageInput.style.display="block";
                    messageInputTextarea.style.display="none";
                    messageInput.focus();
                }
            });
        }

        function emptyInputField(){
            messageInput.value = '';
            messageInputTextarea.value = '';
        }

        showChatProcess.addEventListener("click", function() {
            if (!rotated) {
                chatIcon.style.display = "none";
                crossIcon.style.display = "block";
                showChatProcess.classList.remove("rotate-0");
                showChatProcess.classList.add("rotate-180");
                chatList.style.display = "block";
                chatList.classList.remove("chat-item-slide-out");
                chatList.classList.add("chat-item-slide-in");
                rotated = true;
            } else {
                crossIcon.style.display = "none";
                chatIcon.style.display = "block";
                showChatProcess.classList.remove("rotate-180");
                showChatProcess.classList.add("rotate-0");
                chatList.classList.remove("chat-item-slide-in");
                chatList.classList.add("chat-item-slide-out");
                rotated = false;
            }
        });

        // chatSystem.style.display = 'none';
        // showChatBox.style.display = "flex";
        // showChatBox.style.overflow = "hidden";
        // showChatBox.style.width = "0";
        // showChatBox.style.height = "0";
        // showChatBox.style.width = "300px";
        // showChatBox.style.height = "400px";
        // messageSend.style.display = "flex";

        if (directMessage) {
            directMessage.addEventListener("click", function() {
                if ("{{ Auth::guard('user')->check() }}") {
                    chatSystem.style.display = 'none';
                    showChatBox.style.display = "flex";
                    showChatBox.style.overflow = "hidden";
                    showChatBox.style.width = "0";
                    showChatBox.style.height = "0";

                    chatSystem.style.display="none";

                    const timer = setTimeout(() => {
                        showChatBox.style.transition = "width 0.5s ease, height 0.5s ease";
                        showChatBox.style.width = "300px";
                        showChatBox.style.height = "400px";
                        messageSend.style.display = "flex";
                    }, 50);
                } else {
                    showErrorMessage.innerText = "Please Login First";
                    showError.style.display = "flex";
                    showError.classList.add("z-20", "bg-black", "bg-opacity-80");
                    document.body.style.overflow = 'hidden';
                }
            })
        }

        if(closeChatBox){
            closeChatBox.addEventListener("click", function() {
                showChatBox.style.display = "none";
                showChatBox.style.overflow = "hidden";
                showChatBox.style.width = "0";
                showChatBox.style.height = "0";
                showChatBox.style.transition = "";

                chatSystem.style.display = "block";
                crossIcon.style.display = "block";
                showChatProcess.classList.remove("rotate-0");
                showChatProcess.classList.add("rotate-180");
                chatList.classList.remove("chat-item-slide-out");
                chatList.classList.add("chat-item-slide-in");
            });
        }

        function getPosition(element) {
            const position = element.getBoundingClientRect();
            const centerPoint = {
                centerX: position.x + position.width / 2,
                centerY: position.y + position.height / 2,
                width: position.width,
                height: position.height
            };
            return centerPoint;
        }

        function getBackgroundColorAtPoint(x, y, width) {
            const pixel = document.elementFromPoint(x + width, y);
            if (!pixel) 
                return null;

            const computedStyle = window.getComputedStyle(pixel);
            return computedStyle.backgroundColor;
        }

        const chatIconColorChange = document.getElementById("chatWidget");

        const chatButton = document.querySelector("#showChatProcess button");

        document.addEventListener("scroll", function() {
            const getPos = getPosition(chatIconColorChange);
            // const iconColor = getBackgroundColorAtPoint(
            //     getPos.centerX,
            //     getPos.centerY,
            //     getPos.width
            // );
            const bgColor = getBackgroundColorAtPoint(
                getPos.centerX,
                getPos.centerY,
                getPos.width
            );
            if (bgColor == 'rgb(248, 86, 6)') {
                chatButton.style.backgroundColor = "#1ca3e4";
            } else {
                chatButton.style.backgroundColor = "#f85606";
            }
        });

        // Empty the input field when reload the page
        window.addEventListener('load', function() {
            emptyInputField();
        });
    })
</script>
